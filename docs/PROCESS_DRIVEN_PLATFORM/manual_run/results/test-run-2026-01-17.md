# Manual Test Run Results - 2026-01-17

> **Date**: 2026-01-17
> **Tester**: [To be filled]
> **Environment**: Local Development
> **Backend Version**: [git commit from current branch]

---

## Test Environment Setup

### Agents Deployed
- [x] process-echo - Deployed from `agents/process-echo/` ✅
- [x] process-worker - Deployed from `agents/process-worker/` ✅
- [x] process-failer - Deployed from `agents/process-failer/` ✅

### Backend Status
- [x] Backend running (`docker compose up -d`) ✅
- [x] API accessible at http://localhost:8000 ✅
- [x] Database initialized ✅

### Pre-Test Checklist
- [x] All services healthy ✅
- [x] Test agents deployed via API ✅
- [x] Agents verified running ✅

---

## Tier 1: Critical Path (4 tests)

| ID | Test | Status | Notes |
|----|------|--------|-------|
| T1.1 | Single agent step | ✅ Pass | Execution completed in ~10s |
| T1.2 | Two sequential steps | ✅ Pass | Both steps completed, ~20s total |
| T1.3 | Three steps with dependencies | ✅ Pass | All 3 steps completed (~50s) |
| T1.4 | Step with structured output | ✅ Pass | All 4 steps completed (~40s) |

### T1.1 - Single Agent Step
- **Process File**: `processes/tier1/t1.1-single-step.yaml`
- **Process ID**: `33e1e775-67ac-4c30-bea3-58cfb23e3e24`
- **Execution ID**: `1fa3bb17-f517-48d0-b0d0-f5762234c060`
- **Status**: ✅ Pass
- **Steps completed**: 1/1
- **Output verified**: ✅ Agent returned response with cost tracking
- **Notes**: Agent returned conversational response. Process Engine worked correctly.

### T1.2 - Two Sequential Steps
- **Process File**: `processes/tier1/t1.2-two-sequential.yaml`
- **Process ID**: `50f3b061-9395-454e-a624-0f70853abc88`
- **Execution ID**: `b9da87ee-3add-4ea7-8383-e69197dea2c8`
- **Status**: ✅ Pass
- **Template substitution worked**: ✅ (step2 ran after step1)
- **Notes**: Sequential dependency enforced correctly. ~20s total execution.

### T1.3 - Three Steps with Dependencies (Retry)
- **Process File**: `processes/tier1/t1.3-three-steps.yaml`
- **Process ID**: `4699564c-2844-4185-9c95-b29b3232105b`
- **Execution ID**: `f379b309-f79b-4008-a04a-90ccb7f6aef1`
- **Status**: ✅ Pass (after timeout fix)
- **Dependency order correct**: ✅ research → analyze → report
- **Notes**: Required 120s timeout. All steps completed in ~50s total.

### T1.4 - Structured Output (Retry)
- **Process File**: `processes/tier1/t1.4-structured-output.yaml`
- **Process ID**: `caea4ebb-73a7-4197-ab90-c90c111b9636`
- **Execution ID**: `ca000bd9-03dd-407d-abd6-2e3176a06e27`
- **Status**: ✅ Pass (after fixing `/structured` command)
- **Nested paths worked**: ✅ All 4 steps completed
- **Notes**: Replaced `/structured` command with natural language request. Parallel steps (use-nested-value, worker-analysis) ran correctly.

---

## Tier 2: Conditional Logic (4 tests)

| ID | Test | Status | Notes |
|----|------|--------|-------|
| T2.1 | Exclusive gateway (XOR) | ✅ Pass | high-path selected correctly |
| T2.2 | Gateway with default route | ✅ Pass | default-handler selected |
| T2.3 | Parallel execution (fork/join) | ✅ Pass | 3 branches ran in parallel |
| T2.4 | Conditional skip | ✅ Pass | optional-step skipped correctly |

### T2.1 - Exclusive Gateway
- **Process File**: `processes/tier2/t2.1-exclusive-gateway.yaml`
- **Execution ID**: `8d2cb286-c57a-4834-84b0-248620a3627c`
- **Status**: ✅ Pass
- **Tested routes**: ✅ high (score=90)
- **Notes**: Gateway routed to `high-path` correctly. `medium-path` and `low-path` skipped. Required fixing route syntax (`target` not `next`, path syntax for conditions).

### T2.2 - Gateway Default
- **Process File**: `processes/tier2/t2.2-gateway-default.yaml`
- **Execution ID**: `751efd3a-8b69-4ac5-9313-0154f9889d55`
- **Status**: ✅ Pass
- **Default route triggered**: ✅
- **Notes**: With input `category=unknown`, no conditions matched, default-handler was correctly executed. `urgent-handler` and `normal-handler` skipped.

### T2.3 - Parallel Execution
- **Process File**: `processes/tier2/t2.3-parallel-execution.yaml`
- **Execution ID**: `636dc7f8-cd23-4223-a340-c9509a083b5b`
- **Status**: ✅ Pass
- **Branches ran in parallel**: ✅ (all 3 branches started together after `start`)
- **Join waited for all**: ✅
- **Notes**: `branch-a`, `branch-b`, `branch-c` all ran concurrently. `merge` step waited for all three before running. Total ~25s.

### T2.4 - Conditional Skip
- **Process File**: `processes/tier2/t2.4-conditional-skip.yaml`
- **Execution ID**: `e16e8f38-0169-4f09-9dce-2f3f0486f3fe`
- **Status**: ✅ Pass
- **Step skipped when condition false**: ✅
- **Downstream still ran**: ✅
- **Notes**: With `run_optional=false`, `optional-step` was skipped. `final-step` correctly waited for both `required-step` (completed) and `optional-step` (skipped) before running.

---

## Tier 3: Human Approval (4 tests)

| ID | Test | Status | Notes |
|----|------|--------|-------|
| T3.1 | Approval - approved | ⬜ | |
| T3.2 | Approval - rejected | ⬜ | |
| T3.3 | Approval timeout | ⬜ | |
| T3.4 | Approval with artifacts | ⬜ | |

### T3.1 - Approval Approved
- **Process File**: `processes/tier3/t3.1-approval-approved.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Paused at approval**: ⬜
- **Continued after approve**: ⬜
- **Approval metadata available**: ⬜
- **Notes**:

### T3.2 - Approval Rejected
- **Process File**: `processes/tier3/t3.2-approval-rejected.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Rejection path taken**: ⬜
- **Process completed (not failed)**: ⬜
- **Notes**:

### T3.3 - Approval Timeout
- **Process File**: `processes/tier3/t3.3-approval-timeout.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Timeout triggered**: ⬜
- **on_timeout action worked**: ⬜
- **Notes**:

### T3.4 - Approval with Artifacts
- **Process File**: `processes/tier3/t3.4-approval-artifacts.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Artifacts visible in approval**: ⬜
- **Notes**:

---

## Tier 4: Error Handling (5 tests)

| ID | Test | Status | Notes |
|----|------|--------|-------|
| T4.1 | Agent returns error | ⬜ | |
| T4.2 | Agent timeout | ⬜ | |
| T4.3 | Retry policy works | ⬜ | |
| T4.4 | Skip on error | ⬜ | |
| T4.5 | Cancel running execution | ⬜ | |

### T4.1 - Agent Error
- **Process File**: `processes/tier4/t4.1-agent-error.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Error propagated to step**: ⬜
- **Execution status FAILED**: ⬜
- **Error message captured**: ⬜
- **Notes**:

### T4.2 - Agent Timeout
- **Process File**: `processes/tier4/t4.2-agent-timeout.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Timeout triggered at ~15s**: ⬜
- **Error code is TIMEOUT**: ⬜
- **Notes**:

### T4.3 - Retry Policy
- **Process File**: `processes/tier4/t4.3-retry-policy.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Failed attempts**: /2
- **Final attempt succeeded**: ⬜
- **Backoff delays observed**: ⬜
- **Notes**:

### T4.4 - Skip on Error
- **Process File**: `processes/tier4/t4.4-skip-on-error.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Failed step marked SKIPPED**: ⬜
- **Process completed (not failed)**: ⬜
- **Notes**:

### T4.5 - Cancel Execution
- **Process File**: `processes/tier4/t4.5-cancel-execution.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Cancel API worked**: ⬜
- **Execution status CANCELLED**: ⬜
- **Notes**:

---

## Tier 5: Edge Cases (5 tests)

| ID | Test | Status | Notes |
|----|------|--------|-------|
| T5.1 | 10-step sequential | ⬜ | |
| T5.2 | Diamond pattern | ⬜ | |
| T5.3 | Deeply nested expressions | ⬜ | |
| T5.4 | Concurrent executions (3x) | ⬜ | |
| T5.5 | Recovery after backend restart | ⬜ | |

### T5.1 - Ten Step Chain
- **Process File**: `processes/tier5/t5.1-ten-step-chain.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **All 10 steps completed**: ⬜
- **Total execution time**:
- **Notes**:

### T5.2 - Diamond Pattern
- **Process File**: `processes/tier5/t5.2-diamond-pattern.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Both diamonds executed correctly**: ⬜
- **Parallel branches verified**: ⬜
- **Notes**:

### T5.3 - Nested Expressions
- **Process File**: `processes/tier5/t5.3-nested-expressions.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Deep paths resolved**: ⬜
- **No expression errors**: ⬜
- **Notes**:

### T5.4 - Concurrent Executions
- **Process File**: `processes/tier5/t5.4-concurrent-executions.yaml`
- **Execution IDs**: #1: / #2: / #3: / #4:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **3 concurrent started**: ⬜
- **4th returned 429**: ⬜
- **Limit status endpoint worked**: ⬜
- **Notes**:

### T5.5 - Recovery Test
- **Process File**: `processes/tier5/t5.5-recovery-test.yaml`
- **Execution ID**:
- **Status**: ⬜ Pass / ⬜ Fail / ⬜ Skip
- **Backend restarted during execution**: ⬜
- **Recovery service resumed**: ⬜
- **Process completed after recovery**: ⬜
- **Notes**:

---

## Summary

| Tier | Passed | Failed | Skipped | Target |
|------|--------|--------|---------|--------|
| Tier 1 | **4/4** | 0 | 0 | 4/4 (blocking) ✅ |
| Tier 2 | **4/4** | 0 | 0 | 3/4 ✅ |
| Tier 3 | /4 | | | 2/4 |
| Tier 4 | /5 | | | 3/5 |
| Tier 5 | /5 | | | 2/5 |
| **Total** | **8/22** | 0 | 14 | **14/22** |

---

## Issues Found & Resolved

### Issue #1: 30s timeout too short (RESOLVED)
- **Test**: T1.3
- **Severity**: Medium
- **Root Cause**: Default 30s timeout insufficient for Claude agent response
- **Fix**: Increased timeout to 120s in test files
- **Status**: ✅ Resolved - T1.3 now passes

### Issue #2: Slash commands cause empty response (RESOLVED)
- **Test**: T1.4
- **Severity**: High
- **Root Cause**: Claude interprets `/command` syntax as internal commands, returns empty
- **Fix**: Changed `/structured` to natural language: "Return ONLY this JSON..."
- **Status**: ✅ Resolved - T1.4 now passes

### Issue #3: Custom agent instructions not loaded
- **Test**: All
- **Severity**: Medium
- **Root Cause**: Agent CLAUDE.md files not automatically injected during deploy-local
- **Fix**: Manually inject via `docker exec trinity-backend curl POST "http://agent-{name}:8000/api/trinity/inject"`
- **Status**: ✅ Resolved - Auto-injection added to deploy.py (commit 49a9897)

### Issue #4: Gateway route syntax undocumented (RESOLVED)
- **Test**: T2.1, T2.2
- **Severity**: Medium
- **Root Cause**: Gateway routes use `target` not `next`, `default_route` at step level not as route
- **Fix**: Updated test YAMLs with correct syntax
- **Details**:
  - Routes need `target` field (not `next`)
  - Default route via `default_route:` at step level (not `default: true` in route)
  - Step conditions use path syntax (`steps.x.output.y`) not template syntax (`{{steps.x.output.y}}`)
- **Status**: ✅ Resolved - Tests updated with correct syntax

---

## Observations

### Performance
- T1.1 (single step): ~10s total execution
- T1.2 (two sequential): ~20s total execution
- T1.3 (three steps): ~50s total execution
- T1.4 (four steps, 2 parallel): ~40s total execution
- Agent response time: 4-20s per step

### UX Issues
- Process validation errors not descriptive (e.g., "Invalid version format" without example)
- Trigger type "manual" not supported - should use "webhook"
- Version format must be "X.Y" not "X.Y.Z"

### Architecture Findings
- Process Engine correctly handles sequential and parallel execution
- Dependency resolution working correctly
- Step timeout enforcement accurate
- Agent communication through MCP gateway works reliably

### Recommended Improvements
1. Auto-inject CLAUDE.md during deploy-local process
2. Increase default timeout to 120s for agent_task steps
3. Add validation error examples in schema docs
4. Document that `/command` syntax doesn't work with Claude agents

---

## Next Steps
- [ ]
- [ ]
- [ ]

---

## Document History

| Date | Change |
|------|--------|
| 2026-01-17 | Initial test run document created |
